<!--
 * @Author: NeiDeMing
 * @Date: 2020-04-17 15:56:57
 * @LastEditors: NeiDeMing
 * @LastEditTime: 2020-04-23 22:09:56
 * @FilePath: \autoJs\electronChanDao\index.html
 -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="./public/layui/css/layui.css" media="all">
  <title>禅道助手</title>
  <style>
    .contain {
      display: flex;
    }

    .contain>div {
      flex: 1;
    }
  </style>
</head>

<body>
  <input type="hidden" id="gitData">
  <div class="contain">
    <div>
      <button id='getBug'>
        启动禅道定时任务(2,1)
      </button>
      <p>
        <span>上次获取bug数量：<strong id="preBugNum"></strong></span>
      </p>
      <p>
        <span>本次获取bug数量：<strong id="lastBugNum"></strong></span>
      </p>
      <p>
        <span>本次获取bug新增：<strong id="lastAddBugNum"></strong></span>
      </p>
    </div>
    <div>
      <h3>禅道BUG状态</h3>
      <label for="dateStart">
        开始时间:
        <input type="date" name="dateStart" id="dateStart">
      </label>
      </br>
      <label for="dateEnd">
        结束时间:
        <input type="date" name="dateEnd" id="dateEnd">
      </label>
      </br>
      <label for="gitBranch">
        选择分支
        <select name="gitBranch" id="gitBranch" title="默认选择develop分支">
          <option value="develop">--</option>
          <option value="develop">develop</option>
          <!-- <option value="feature">feature</option>
          <option value="hotfix">hotfix</option>
          <option value="master">master</option>
          <option value="release">release</option> -->
        </select>
      </label>
      </br>
      <label for="generateTable" style="display: flex;margin-top: 10px;">
        <button class="layui-btn" id="generateTable" name="generateTable">
          生成表格
        </button>
        <button style="margin-left: 10px;" class="layui-btn layui-btn-danger">获取已关闭Bug</button>
        <button style="margin-left: 10px;" class="layui-btn">还原</button>
        <button style="margin-left: 10px;" class="layui-btn" id="exportExcel">导出</button>
      </label>
      <p style="margin-top: 10px;">
        <button class="layui-btn" id="cherry-pick" data-type="getCheckData">单个commit合并(develop2master)</button>
        <button class="layui-btn" id="btn-close" data-value="前端已fix/done，待发包后，请测试。">关闭禅道Bug</button>
      </p>
    </div>
  </div>
  <table class="layui-hide" id="chanDaoTable"></table>
  <script type="text/javascript">
    require('./renderer')
  </script>
  <script src="./public/layui/layui.js" charset="utf-8"></script>
  <script>
    document.querySelector('#generateTable').addEventListener('click', (e) => {
      console.log(JSON.parse(document.querySelector('#gitData').value))
      let data = JSON.parse(document.querySelector('#gitData').value)
      setTable(data)
    })

    function setTable(data) {
      layui.use('table', function () {
        let table = layui.table
        let form = layui.form;

        table.render({
          elem: '#chanDaoTable',
          url: '',
          cellMinWidth: 80,
          height: 500,
          id: 'idTest',
          cols: [
            [{
              type: 'numbers'
            }, {
              type: 'checkbox'
            }, {
              field: 'committed_date',
              title: 'committed_date',
              sort: true
            }, {
              field: 'committer_name',
              title: 'committer_name',
              sort: true
            }, {
              field: 'message',
              title: 'commit message',
              sort: true
            }, {
              field: 'type',
              title: 'type',
              sort: true
            }, {
              field: 'typeId',
              title: 'type_id',
              sort: true
            }, {
              field: 'content',
              title: 'Bug状态',
              templet: function (d) {
                if (d.content === '已关闭') {
                  return '<span style="color:red;">' + d.content + '</span>'
                }
                return d.content ? d.content : ''
              },
              sort: true
            }, {
              field: 'status',
              title: '获取状态',
              templet: function (d) {
                if (d.status === '成功') {
                  return '<span style="color:red;">' + d.status + '</span>'
                }
                return d.status ? d.status : ''
              },
              sort: true
            }, {
              field: 'develop2Master',
              title: 'develop2Master',
              sort: true
            }, {
              field: 'parent_ids',
              title: 'parent_ids',
              sort: true
            }]
          ],
          data: data,
          limit: 999
        });
        
        let active = {
          getCheckData: function () { //获取选中数据
            var checkStatus = table.checkStatus('idTest'),
              data = checkStatus.data;
            console.log(data)
          }
        };
        document.querySelector('#cherry-pick').addEventListener('click', function () {
          let type = this.getAttribute('data-type');
          active[type] ? active[type].call(this) : '';
        });
      });
    }
  </script>
</body>

</html>